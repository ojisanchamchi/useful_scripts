<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.10.0">Jekyll</generator><link href="https://yourusername.github.io/useful_scripts/feed.xml" rel="self" type="application/atom+xml" /><link href="https://yourusername.github.io/useful_scripts/" rel="alternate" type="text/html" /><updated>2025-10-15T08:56:26+00:00</updated><id>https://yourusername.github.io/useful_scripts/feed.xml</id><title type="html">Useful Scripts Documentation</title><subtitle>A blog for documenting how and when to use the scripts in this repository.</subtitle><entry><title type="html">Triển khai ImunifyAV tự động cho Bitrix</title><link href="https://yourusername.github.io/useful_scripts/2025/10/15/imunifyav-trien-khai-bitrix.html" rel="alternate" type="text/html" title="Triển khai ImunifyAV tự động cho Bitrix" /><published>2025-10-15T17:00:00+00:00</published><updated>2025-10-15T17:00:00+00:00</updated><id>https://yourusername.github.io/useful_scripts/2025/10/15/imunifyav-trien-khai-bitrix</id><content type="html" xml:base="https://yourusername.github.io/useful_scripts/2025/10/15/imunifyav-trien-khai-bitrix.html"><![CDATA[<blockquote>
  <p>Bài viết này tổng hợp lại toàn bộ script trong thư mục <code class="language-plaintext highlighter-rouge">imunifyav/</code> và hướng dẫn bạn tái sử dụng chúng để triển khai ImunifyAV nhanh chóng cho hạ tầng Bitrix.</p>
</blockquote>

<h2 id="tổng-quan-giải-pháp">Tổng quan giải pháp</h2>
<ul>
  <li>Bộ script giúp tự động hoá quá trình cài đặt ImunifyAV, cấu hình tích hợp với giao diện Bitrix và thiết lập cảnh báo khi phát hiện mã độc.</li>
  <li>Hai script cài đặt chính hỗ trợ song song cho môi trường CentOS/CloudLinux (<code class="language-plaintext highlighter-rouge">iav_setup.sh</code>) và Debian (<code class="language-plaintext highlighter-rouge">iav_setup_debian.sh</code>), trong khi các script còn lại đóng vai trò hỗ trợ (cung cấp dữ liệu người dùng/domain, hook thông báo, proxy repo…).</li>
  <li>Tất cả đều giả định hệ thống chạy với user <code class="language-plaintext highlighter-rouge">bitrix</code>, thư mục web chính <code class="language-plaintext highlighter-rouge">/home/bitrix/www</code> (hoặc <code class="language-plaintext highlighter-rouge">/var/www/bitrix/default</code> trên Debian) và yêu cầu sẵn quyền <code class="language-plaintext highlighter-rouge">root</code>.</li>
</ul>

<h2 id="chuẩn-bị-trước-khi-chạy">Chuẩn bị trước khi chạy</h2>
<ul>
  <li>SMTP nội bộ hoạt động để script có thể gửi email qua <code class="language-plaintext highlighter-rouge">mailx</code>.</li>
  <li>Cài sẵn <code class="language-plaintext highlighter-rouge">curl</code>, <code class="language-plaintext highlighter-rouge">wget</code> và đảm bảo truy cập được tới internet. Nếu bị chặn HTTPS tới CloudLinux, cấu hình thêm reverse proxy theo mẫu <code class="language-plaintext highlighter-rouge">nginx_proxy.conf</code>.</li>
  <li>Xác định email nhận cảnh báo, ví dụ <code class="language-plaintext highlighter-rouge">security@example.com</code>.</li>
  <li>Với Debian, cần các package: <code class="language-plaintext highlighter-rouge">s-nail</code>, <code class="language-plaintext highlighter-rouge">jq</code>.</li>
</ul>

<h2 id="các-script-thành-phần">Các script thành phần</h2>
<ul>
  <li><strong>get-users.sh</strong>: trả về danh sách user tích hợp cho ImunifyAV thông qua <code class="language-plaintext highlighter-rouge">jq</code>. Mặc định tạo user <code class="language-plaintext highlighter-rouge">bitrix</code> với UID 600.</li>
  <li><strong>get-domains.sh</strong>: cung cấp thông tin domain chính và domain phụ của Bitrix, giúp giao diện Imunify hiển thị đúng cấu trúc thư mục.</li>
  <li><strong>iav_hook.sh</strong>: hook đa năng đọc payload JSON, gửi mail hoặc lưu file nhật ký. Bạn chỉ việc chỉnh <code class="language-plaintext highlighter-rouge">MAIL_TO</code> và thư mục lưu.</li>
  <li><strong>iav_notify.sh</strong>: phương án gửi thông báo siêu gọn (một dòng email). Có thể dùng độc lập nếu không cần logic phức tạp.</li>
  <li><strong>iav_setup.sh / iav_setup_debian.sh</strong>: trái tim của quá trình cài đặt. Chúng tải toàn bộ script hỗ trợ, tạo symlink giao diện, cấu hình ignore list, thiết lập lịch quét, cập nhật tham số hiệu năng, và đăng ký hook thông báo.</li>
  <li><strong>nginx_proxy.conf</strong>: template cấu hình Nginx reverse proxy tới các endpoint của CloudLinux phòng trường hợp mạng nội bộ chặn HTTPS trực tiếp.</li>
</ul>

<h2 id="cài-đặt-trên-centoscloudlinux">Cài đặt trên CentOS/CloudLinux</h2>
<p>Chạy script với tham số email nhận cảnh báo:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-sL</span> https://raw.githubusercontent.com/YogSottot/useful_scripts/master/imunifyav/iav_setup.sh <span class="se">\</span>
  | bash <span class="nt">-s</span> <span class="nt">--</span> security@example.com
</code></pre></div></div>

<p>Script sẽ thực hiện:</p>
<ul>
  <li>Cài <code class="language-plaintext highlighter-rouge">mailx</code>, <code class="language-plaintext highlighter-rouge">jq</code>, <code class="language-plaintext highlighter-rouge">oniguruma</code>.</li>
  <li>Tạo <code class="language-plaintext highlighter-rouge">/etc/sysconfig/imunify360/integration.conf</code> và map các script <code class="language-plaintext highlighter-rouge">get-users.sh</code>, <code class="language-plaintext highlighter-rouge">get-domains.sh</code>.</li>
  <li>Đồng bộ thư mục giao diện <code class="language-plaintext highlighter-rouge">/opt/iav/.imunifyav</code> vào <code class="language-plaintext highlighter-rouge">/home/bitrix/www/</code>.</li>
  <li>Tải về hook/utility script, set quyền thực thi và chèn email vào <code class="language-plaintext highlighter-rouge">iav_hook.sh</code>.</li>
  <li>Cài ImunifyAV thông qua <code class="language-plaintext highlighter-rouge">imav-deploy.sh</code> (mặc định lấy từ mirror <code class="language-plaintext highlighter-rouge">imun.0fr.ru</code>).</li>
  <li>Đăng ký hook cho sự kiện <code class="language-plaintext highlighter-rouge">USER_SCAN_MALWARE_FOUND</code> và <code class="language-plaintext highlighter-rouge">CUSTOM_SCAN_MALWARE_FOUND</code>.</li>
  <li>Thêm danh sách thư mục bỏ qua (cache, backup, upload của Bitrix).</li>
  <li>Tuỳ chỉnh cấu hình scan (Hyperscan, giới hạn CPU/IO/RAM) và tạo cron quét hằng ngày lúc 01:10.</li>
  <li>Điều chỉnh <code class="language-plaintext highlighter-rouge">login.defs</code> để UID/GID 600 trở thành user thường, phù hợp với user <code class="language-plaintext highlighter-rouge">bitrix</code>.</li>
</ul>

<h2 id="cài-đặt-trên-debian">Cài đặt trên Debian</h2>
<p>Thao tác tương tự nhưng dùng script dành riêng:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-sL</span> https://raw.githubusercontent.com/YogSottot/useful_scripts/master/imunifyav/iav_setup_debian.sh <span class="se">\</span>
  | bash <span class="nt">-s</span> <span class="nt">--</span> security@example.com
</code></pre></div></div>

<p>Điểm khác biệt:</p>
<ul>
  <li>Dùng <code class="language-plaintext highlighter-rouge">apt</code> và <code class="language-plaintext highlighter-rouge">s-nail</code>.</li>
  <li>Symlink giao diện về <code class="language-plaintext highlighter-rouge">/var/www/bitrix/default</code>.</li>
  <li>Mirror repo sử dụng domain <code class="language-plaintext highlighter-rouge">repoimun.0fr.ru</code> và <code class="language-plaintext highlighter-rouge">filesimun.0fr.ru</code>, <code class="language-plaintext highlighter-rouge">apiimun.0fr.ru</code>.</li>
  <li>Chỉnh sửa đường dẫn bỏ qua, cron và ignore list tương ứng môi trường Debian.</li>
  <li>Trigger khởi động lại hàng loạt service Imunify để áp dụng cấu hình mới.</li>
</ul>

<h2 id="tuỳ-chỉnh-cảnh-báo-và-lưu-trữ">Tuỳ chỉnh cảnh báo và lưu trữ</h2>
<ul>
  <li>Để nhận mail giàu thông tin, bật <code class="language-plaintext highlighter-rouge">MAIL_ENABLE=yes</code> trong <code class="language-plaintext highlighter-rouge">iav_hook.sh</code> và cấu hình <code class="language-plaintext highlighter-rouge">MAIL_TO</code>.</li>
  <li>Nếu cần lưu log, giữ <code class="language-plaintext highlighter-rouge">FILE_ENABLE=yes</code>; script sẽ tạo thư mục <code class="language-plaintext highlighter-rouge">/tmp/imunify-script-files</code> và log theo tên sự kiện.</li>
  <li>Có thể thêm custom handler bên dưới mỗi <code class="language-plaintext highlighter-rouge"># append your stuff here</code> để gọi webhook, Slack, Telegram…</li>
</ul>

<h2 id="quản-lý-danh-sách-bỏ-qua">Quản lý danh sách bỏ qua</h2>
<ul>
  <li>Các script thêm sẵn ignore list cho cache/backup của Bitrix để tránh false positive.</li>
  <li>Nếu bạn lưu mã nguồn ở thư mục khác, bổ sung vào <code class="language-plaintext highlighter-rouge">/etc/sysconfig/imunify360/malware-filters-admin-conf/ignored.txt</code>.</li>
  <li>Khi cần quét đầy đủ, có thể tạm thời xoá các dòng ignore và chạy:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>imunify-antivirus update sigs
imunify-antivirus malware on-demand start <span class="nt">--path</span><span class="o">=</span><span class="s1">'/home/bitrix/'</span> <span class="nt">--file-mask</span><span class="o">=</span><span class="s2">"*.php,*.js,*.html,.htaccess"</span>
</code></pre></div></div>

<h2 id="lịch-quét-và-tài-nguyên">Lịch quét và tài nguyên</h2>
<ul>
  <li>Cron mặc định chạy lúc 01:10 mỗi ngày: cập nhật chữ ký trước khi quét.</li>
  <li>Tham số <code class="language-plaintext highlighter-rouge">--intensity-cpu</code> và <code class="language-plaintext highlighter-rouge">--intensity-io</code> được đặt ở mức 3, phù hợp server vừa phải. Điều chỉnh tại <code class="language-plaintext highlighter-rouge">/etc/cron.d/iav_scan_schedule</code>.</li>
  <li>Các lệnh <code class="language-plaintext highlighter-rouge">imunify-antivirus config update</code> trong script đã giới hạn CPU/IO/RAM khi quét để không ảnh hưởng website.</li>
</ul>

<h2 id="kiểm-tra-sau-cài-đặt">Kiểm tra sau cài đặt</h2>
<ol>
  <li>Đăng nhập giao diện ImunifyAV và xác minh danh sách domain hiển thị đúng.</li>
  <li>Thực hiện quét thử rồi kiểm tra email/đường dẫn log nhận được từ <code class="language-plaintext highlighter-rouge">iav_hook.sh</code>.</li>
  <li>Đảm bảo cron đã tạo: <code class="language-plaintext highlighter-rouge">crontab -l -u root | grep iav_scan_schedule</code>.</li>
  <li>Theo dõi <code class="language-plaintext highlighter-rouge">/opt/iav/</code> xem các script có cập nhật và quyền sở hữu <code class="language-plaintext highlighter-rouge">root:_imunify</code>.</li>
</ol>

<h2 id="gợi-ý-bảo-trì">Gợi ý bảo trì</h2>
<ul>
  <li>Khi CloudLinux thay đổi endpoint, cập nhật các mirror trong <code class="language-plaintext highlighter-rouge">nginx_proxy.conf</code> và phần <code class="language-plaintext highlighter-rouge">sed</code> của script.</li>
  <li>Giữ <code class="language-plaintext highlighter-rouge">jq</code>, <code class="language-plaintext highlighter-rouge">imunify-antivirus</code> ở phiên bản mới. Có thể tự động hoá bằng cron <code class="language-plaintext highlighter-rouge">yum update imunify-antivirus</code> hoặc <code class="language-plaintext highlighter-rouge">apt upgrade</code>.</li>
  <li>Định kỳ rà soát ignore list để tránh bỏ sót file độc hại mới.</li>
</ul>

<p>Với bộ script này, bạn có thể chuẩn hoá việc triển khai ImunifyAV cho nhiều máy chủ Bitrix, giảm thao tác thủ công và đảm bảo mỗi đợt quét đều gửi cảnh báo kịp thời.</p>]]></content><author><name></name></author><category term="imunifyav" /><category term="security" /><category term="bitrix" /><summary type="html"><![CDATA[Bài viết này tổng hợp lại toàn bộ script trong thư mục imunifyav/ và hướng dẫn bạn tái sử dụng chúng để triển khai ImunifyAV nhanh chóng cho hạ tầng Bitrix.]]></summary></entry><entry><title type="html">Thiết lập Máy chủ Linux Ban đầu: Hướng dẫn Chi tiết cho DevOps và Full-stack Developer</title><link href="https://yourusername.github.io/useful_scripts/initial-setup/2025/10/15/initial-server-setup-guide-detailed.html" rel="alternate" type="text/html" title="Thiết lập Máy chủ Linux Ban đầu: Hướng dẫn Chi tiết cho DevOps và Full-stack Developer" /><published>2025-10-15T11:30:00+00:00</published><updated>2025-10-15T11:30:00+00:00</updated><id>https://yourusername.github.io/useful_scripts/initial-setup/2025/10/15/initial-server-setup-guide-detailed</id><content type="html" xml:base="https://yourusername.github.io/useful_scripts/initial-setup/2025/10/15/initial-server-setup-guide-detailed.html"><![CDATA[<p>Chào các bạn DevOps và Full-stack Developer!</p>

<p>Việc thiết lập một máy chủ Linux mới từ đầu có thể là một nhiệm vụ tốn thời gian và dễ mắc lỗi. Để đảm bảo máy chủ của bạn hoạt động hiệu quả, bảo mật và tuân thủ các tiêu chuẩn, việc tự động hóa là chìa khóa. Bộ script <code class="language-plaintext highlighter-rouge">initial_server_setup</code> này được thiết kế để giúp bạn thực hiện điều đó, biến quá trình cấu hình ban đầu thành một quy trình nhanh chóng và đáng tin cậy.</p>

<p>Bài viết này sẽ đi sâu vào từng phần của script <code class="language-plaintext highlighter-rouge">initial_setup.sh</code> và các script hỗ trợ, giải thích chi tiết từng bước, cung cấp các đoạn mã quan trọng, lý do cần chúng và cách bạn có thể tùy chỉnh.</p>

<h2 id="cách-thực-hiện">Cách Thực Hiện</h2>

<p>Để bắt đầu, bạn chỉ cần tải xuống và chạy script <code class="language-plaintext highlighter-rouge">initial_setup.sh</code> trên máy chủ Linux (ưu tiên CentOS/RHEL) của mình.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash &lt;<span class="o">(</span>curl <span class="nt">-sL</span> https://raw.githubusercontent.com/YogSottot/useful_scripts/master/initial_server_setup/initial_setup.sh<span class="o">)</span>
</code></pre></div></div>

<p><strong>Lưu ý quan trọng:</strong> Luôn đọc và hiểu nội dung của bất kỳ script nào trước khi chạy nó trên môi trường production. Script này sẽ thực hiện các thay đổi sâu rộng trên hệ thống của bạn.</p>

<h2 id="phân-tích-chi-tiết-initial_setupsh">Phân Tích Chi Tiết <code class="language-plaintext highlighter-rouge">initial_setup.sh</code></h2>

<p>Script <code class="language-plaintext highlighter-rouge">initial_setup.sh</code> là một tập hợp các lệnh được thực thi tuần tự để cấu hình máy chủ. Dưới đây là phân tích từng phần:</p>

<h3 id="1-cài-đặt-các-chương-trình-hữu-ích">1. Cài đặt các Chương trình Hữu ích</h3>

<p>Đầu tiên, script sẽ cài đặt một loạt các gói phần mềm cần thiết cho việc quản lý, giám sát và tối ưu hóa máy chủ.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nt">-y</span> <span class="nb">install</span> <span class="nt">--enablerepo</span><span class="o">=</span>epel wget byobu chrony net-tools certbot ncdu iotop htop bind-utils traceroute mc bash-completion bash-completion-extras yum-utils nano tmux deltarpm jpegoptim optipng libwebp-tools ImageMagick php-pecl-imagick mysqltuner smem lsof
</code></pre></div></div>

<p><strong>Giải thích:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">wget</code>, <code class="language-plaintext highlighter-rouge">curl</code>: Công cụ tải file từ internet.</li>
  <li><code class="language-plaintext highlighter-rouge">byobu</code>, <code class="language-plaintext highlighter-rouge">tmux</code>: Công cụ quản lý phiên terminal, cho phép bạn duy trì các phiên làm việc ngay cả khi mất kết nối SSH.</li>
  <li><code class="language-plaintext highlighter-rouge">chrony</code>: Đồng bộ hóa thời gian hệ thống chính xác hơn <code class="language-plaintext highlighter-rouge">ntpd</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">net-tools</code>, <code class="language-plaintext highlighter-rouge">bind-utils</code>, <code class="language-plaintext highlighter-rouge">traceroute</code>: Các công cụ mạng cơ bản để chẩn đoán và kiểm tra kết nối.</li>
  <li><code class="language-plaintext highlighter-rouge">certbot</code>: Công cụ tự động hóa việc cấp phát và gia hạn chứng chỉ SSL/TLS từ Let’s Encrypt.</li>
  <li><code class="language-plaintext highlighter-rouge">ncdu</code>, <code class="language-plaintext highlighter-rouge">iotop</code>, <code class="language-plaintext highlighter-rouge">htop</code>, <code class="language-plaintext highlighter-rouge">smem</code>, <code class="language-plaintext highlighter-rouge">lsof</code>: Các công cụ giám sát hệ thống mạnh mẽ để theo dõi dung lượng đĩa, I/O, tiến trình, bộ nhớ và các file đang mở.</li>
  <li><code class="language-plaintext highlighter-rouge">mc</code>: Midnight Commander, một trình quản lý file dựa trên terminal.</li>
  <li><code class="language-plaintext highlighter-rouge">bash-completion</code>: Tự động hoàn thành lệnh trong bash.</li>
  <li><code class="language-plaintext highlighter-rouge">nano</code>: Trình soạn thảo văn bản đơn giản.</li>
  <li><code class="language-plaintext highlighter-rouge">deltarpm</code>: Tăng tốc cập nhật <code class="language-plaintext highlighter-rouge">yum</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">jpegoptim</code>, <code class="language-plaintext highlighter-rouge">optipng</code>, <code class="language-plaintext highlighter-rouge">libwebp-tools</code>, <code class="language-plaintext highlighter-rouge">ImageMagick</code>: Các công cụ tối ưu hóa hình ảnh, rất quan trọng cho các ứng dụng web.</li>
  <li><code class="language-plaintext highlighter-rouge">php-pecl-imagick</code>: Extension PHP cho ImageMagick.</li>
  <li><code class="language-plaintext highlighter-rouge">mysqltuner</code>: Script phân tích cấu hình MySQL và đưa ra khuyến nghị tối ưu hóa.</li>
</ul>

<p><strong>Tại sao cần:</strong> Các công cụ này là xương sống cho mọi hoạt động quản trị và phát triển trên máy chủ, từ gỡ lỗi đến tối ưu hóa hiệu suất.</p>

<h3 id="2-cấu-hình-môi-trường-bash-và-liquidprompt">2. Cấu hình Môi trường Bash và Liquidprompt</h3>

<p>Script cấu hình file <code class="language-plaintext highlighter-rouge">.bashrc</code> cho người dùng <code class="language-plaintext highlighter-rouge">root</code> và <code class="language-plaintext highlighter-rouge">bitrix</code> (nếu có), thêm các alias hữu ích và tích hợp <code class="language-plaintext highlighter-rouge">liquidprompt</code> để có một terminal prompt thông minh.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="sh">\</span><span class="no">EOT</span><span class="sh"> &gt;&gt; ~/.bashrc
alias mc='mc -x'
alias door='wget https://raw.githubusercontent.com/YogSottot/useful_scripts/master/bitrix/test.php'
alias lst='ls -alt --time-style=long-iso'
alias ncdu='ncdu --color off'
[[ </span><span class="nv">$-</span><span class="sh"> = *i* ]] &amp;&amp; source /opt/liquidprompt/liquidprompt
export VISUAL=nano
</span><span class="no">EOT

</span><span class="c"># ... (tương tự cho người dùng bitrix) ...</span>

wget https://raw.githubusercontent.com/YogSottot/useful_scripts/master/initial_server_setup/liquidprompt <span class="nt">-N</span> <span class="nt">-O</span> /opt/liquidprompt/liquidprompt
wget https://raw.githubusercontent.com/YogSottot/useful_scripts/master/initial_server_setup/liquidpromptrc <span class="nt">-N</span> <span class="nt">-O</span> ~/.config/liquidpromptrc
<span class="nb">source</span> /opt/liquidprompt/liquidprompt
</code></pre></div></div>

<p><strong>Giải thích:</strong></p>
<ul>
  <li><strong>Aliases</strong>: Các lệnh tắt như <code class="language-plaintext highlighter-rouge">mc -x</code> (Midnight Commander với hỗ trợ chuột), <code class="language-plaintext highlighter-rouge">lst</code> (liệt kê file chi tiết theo thời gian), <code class="language-plaintext highlighter-rouge">ncdu --color off</code> (ncdu không màu).</li>
  <li><strong><code class="language-plaintext highlighter-rouge">liquidprompt</code></strong>: Một prompt Bash/Zsh thông minh, hiển thị thông tin hữu ích như trạng thái Git, tải hệ thống, thời gian chạy lệnh, v.v. Nó giúp bạn có cái nhìn tổng quan về môi trường làm việc ngay trên dòng lệnh.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">export VISUAL=nano</code></strong>: Đặt <code class="language-plaintext highlighter-rouge">nano</code> làm trình soạn thảo mặc định.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">~/.nanorc</code></strong>: Cấu hình syntax highlighting cho <code class="language-plaintext highlighter-rouge">nano</code>.</li>
</ul>

<p><strong>Tại sao cần:</strong> Cải thiện đáng kể trải nghiệm làm việc trên terminal, giúp bạn làm việc nhanh hơn và hiệu quả hơn.</p>

<h3 id="3-bảo-mật-ssh-key">3. Bảo mật SSH Key</h3>

<p>Script tự động tạo cặp khóa SSH (ED25519) cho người dùng <code class="language-plaintext highlighter-rouge">root</code> và <code class="language-plaintext highlighter-rouge">bitrix</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-q</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.ssh/id_ed25519"</span> <span class="nt">-N</span> <span class="s2">""</span>
<span class="c"># ... (tương tự cho người dùng bitrix) ...</span>
<span class="nb">chown </span>root. /home/bitrix/.ssh/authorized_keys
</code></pre></div></div>

<p><strong>Giải thích:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">ssh-keygen -t ed25519</code>: Tạo cặp khóa SSH sử dụng thuật toán ED25519, được coi là an toàn và hiệu quả hơn RSA.</li>
  <li><code class="language-plaintext highlighter-rouge">-q</code>: Chế độ yên lặng.</li>
  <li><code class="language-plaintext highlighter-rouge">-f "$HOME/.ssh/id_ed25519"</code>: Chỉ định đường dẫn và tên file cho khóa riêng tư.</li>
  <li><code class="language-plaintext highlighter-rouge">-N ""</code>: Không đặt passphrase cho khóa (cần cẩn trọng khi sử dụng trong môi trường production).</li>
  <li><code class="language-plaintext highlighter-rouge">chown root. /home/bitrix/.ssh/authorized_keys</code>: Đảm bảo quyền sở hữu đúng cho file <code class="language-plaintext highlighter-rouge">authorized_keys</code> của người dùng <code class="language-plaintext highlighter-rouge">bitrix</code> để tăng cường bảo mật.</li>
</ul>

<p><strong>Tại sao cần:</strong> SSH key là phương pháp xác thực an toàn hơn nhiều so với mật khẩu, đặc biệt quan trọng cho việc truy cập máy chủ từ xa.</p>

<h3 id="4-cấu-hình-certbot-lets-encrypt">4. Cấu hình Certbot (Let’s Encrypt)</h3>

<p>Phần này thiết lập Certbot để tự động gia hạn chứng chỉ SSL/TLS, đảm bảo website của bạn luôn có HTTPS hợp lệ.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> /etc/letsencrypt/renewal-hooks/deploy/
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'#!/bin/sh\nservice nginx reload'</span> <span class="o">&gt;</span> /etc/letsencrypt/renewal-hooks/deploy/nginx.sh
<span class="nb">chmod</span> +x /etc/letsencrypt/renewal-hooks/deploy/nginx.sh

<span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOT</span><span class="sh"> &gt; /etc/sysconfig/certbot
# ...
DEPLOY_HOOK="--deploy-hook 'systemctl reload nginx'"
CERTBOT_ARGS="--allow-subset-of-names"
</span><span class="no">EOT

</span>systemctl <span class="nb">enable </span>certbot-renew.timer <span class="o">&amp;&amp;</span> systemctl start certbot-renew.timer
</code></pre></div></div>

<p><strong>Giải thích:</strong></p>
<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">nginx.sh</code> deploy hook</strong>: Script này được Certbot chạy sau khi gia hạn chứng chỉ thành công. Nó sẽ reload Nginx để áp dụng chứng chỉ mới.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">/etc/sysconfig/certbot</code></strong>: File cấu hình cho Certbot.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">DEPLOY_HOOK</code>: Chỉ định lệnh sẽ chạy sau khi gia hạn. Ở đây là <code class="language-plaintext highlighter-rouge">systemctl reload nginx</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">CERTBOT_ARGS="--allow-subset-of-names"</code>: Cho phép Certbot gia hạn chứng chỉ ngay cả khi một số tên miền trong chứng chỉ không thể xác thực được (hữu ích trong một số trường hợp đặc biệt).</li>
    </ul>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">certbot-renew.timer</code></strong>: Kích hoạt và khởi động timer của systemd để tự động chạy Certbot định kỳ (thường là hai lần một ngày) để kiểm tra và gia hạn chứng chỉ.</li>
</ul>

<p><strong>Tại sao cần:</strong> HTTPS là tiêu chuẩn bắt buộc cho các website hiện đại, đảm bảo bảo mật dữ liệu truyền tải và cải thiện SEO. Tự động hóa gia hạn giúp tránh tình trạng chứng chỉ hết hạn gây gián đoạn dịch vụ.</p>

<h3 id="5-tối-ưu-hóa-systemd-services">5. Tối ưu hóa Systemd Services</h3>

<p>Script tăng giới hạn tài nguyên và cấu hình tự động khởi động lại cho các dịch vụ quan trọng như Nginx, HTTPD, Memcached.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> /etc/systemd/system/nginx.service.d <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'[Service]\nRestart=on-failure\nRestartSec=5\nLimitNPROC=65535\nLimitNOFILE=1000000'</span> <span class="o">&gt;&gt;</span> /etc/systemd/system/nginx.service.d/override.conf
<span class="c"># ... (tương tự cho httpd và memcached) ...</span>
systemctl daemon-reload
</code></pre></div></div>

<p><strong>Giải thích:</strong></p>
<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">override.conf</code></strong>: Các file này được sử dụng để ghi đè (override) các cấu hình mặc định của dịch vụ systemd mà không cần chỉnh sửa file <code class="language-plaintext highlighter-rouge">.service</code> gốc.</li>
  <li><code class="language-plaintext highlighter-rouge">Restart=on-failure</code>: Dịch vụ sẽ tự động khởi động lại nếu nó thoát với mã lỗi.</li>
  <li><code class="language-plaintext highlighter-rouge">RestartSec=5</code>: Chờ 5 giây trước khi thử khởi động lại.</li>
  <li><code class="language-plaintext highlighter-rouge">LimitNPROC=65535</code>: Tăng giới hạn số lượng tiến trình mà dịch vụ có thể tạo.</li>
  <li><code class="language-plaintext highlighter-rouge">LimitNOFILE=1000000</code>: Tăng giới hạn số lượng file mà dịch vụ có thể mở.</li>
  <li><code class="language-plaintext highlighter-rouge">systemctl daemon-reload</code>: Tải lại cấu hình systemd để áp dụng các thay đổi.</li>
</ul>

<p><strong>Tại sao cần:</strong> Đảm bảo các dịch vụ quan trọng luôn hoạt động ổn định, tự động phục hồi sau sự cố và có đủ tài nguyên để xử lý tải cao.</p>

<h3 id="6-cấu-hình-nginx">6. Cấu hình Nginx</h3>

<p>Các tinh chỉnh cơ bản cho Nginx và tải xuống các file cấu hình Nginx bổ sung.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'gzip_vary on;'</span> <span class="o">&gt;&gt;</span> /etc/nginx/bx/settings/z_bx_custom.conf
systemctl reload nginx

<span class="c"># Tải xuống các file cấu hình Nginx bổ sung</span>
wget https://raw.githubusercontent.com/YogSottot/useful_scripts/master/nginx/ssl.common.conf <span class="nt">-N</span> <span class="nt">-P</span> /etc/nginx/bx/conf/
wget https://raw.githubusercontent.com/YogSottot/useful_scripts/master/nginx/block_access.conf <span class="nt">-N</span> <span class="nt">-P</span> /etc/nginx/
<span class="c"># ... và nhiều file khác ...</span>

nginx <span class="nt">-t</span> <span class="o">&amp;&amp;</span> systemctl reload nginx
</code></pre></div></div>

<p><strong>Giải thích:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">gzip_vary on;</code>: Bật <code class="language-plaintext highlighter-rouge">Vary: Accept-Encoding</code> header cho gzip, giúp các proxy cache phân biệt giữa các phiên bản nén và không nén của tài nguyên.</li>
  <li>Các file <code class="language-plaintext highlighter-rouge">.conf</code> được tải xuống từ thư mục <code class="language-plaintext highlighter-rouge">nginx/</code> bao gồm:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">ssl.common.conf</code>: Cấu hình SSL/TLS chung.</li>
      <li><code class="language-plaintext highlighter-rouge">block_access.conf</code>: Các quy tắc chặn truy cập.</li>
      <li><code class="language-plaintext highlighter-rouge">qrator.conf</code>, <code class="language-plaintext highlighter-rouge">acme_well_known.conf</code>, <code class="language-plaintext highlighter-rouge">locations.conf</code>, <code class="language-plaintext highlighter-rouge">seo.conf</code>: Các cấu hình cụ thể cho Bitrix, Let’s Encrypt challenge, định tuyến URL và SEO.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">nginx -t</code>: Kiểm tra cú pháp cấu hình Nginx.</li>
  <li><code class="language-plaintext highlighter-rouge">systemctl reload nginx</code>: Tải lại cấu hình Nginx mà không làm gián đoạn dịch vụ.</li>
</ul>

<p><strong>Tại sao cần:</strong> Tối ưu hóa Nginx là rất quan trọng để đạt được hiệu suất web cao, bảo mật và khả năng xử lý lưu lượng truy cập lớn.</p>

<h3 id="7-cấu-hình-php">7. Cấu hình PHP</h3>

<p>Script áp dụng các tinh chỉnh cho PHP thông qua file <code class="language-plaintext highlighter-rouge">z_bx_custom.ini</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOT</span><span class="sh"> &gt;&gt; /etc/php.d/z_bx_custom.ini
mail.add_x_header = Off
pcre.recursion_limit = 100000
cgi.fix_pathinfo = 0
max_input_vars = 100000
</span><span class="no">EOT
</span><span class="nb">mv</span> <span class="nt">-f</span> /etc/php.d/20-curl.ini.disabled /etc/php.d/20-curl.ini
</code></pre></div></div>

<p><strong>Giải thích:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">mail.add_x_header = Off</code>: Tắt việc thêm header <code class="language-plaintext highlighter-rouge">X-PHP-Originating-Script</code> vào email, có thể tăng cường bảo mật nhỏ.</li>
  <li><code class="language-plaintext highlighter-rouge">pcre.recursion_limit = 100000</code>: Tăng giới hạn đệ quy cho PCRE (Perl Compatible Regular Expressions), hữu ích cho các ứng dụng PHP sử dụng nhiều regex phức tạp.</li>
  <li><code class="language-plaintext highlighter-rouge">cgi.fix_pathinfo = 0</code>: Một cài đặt bảo mật quan trọng. Khi <code class="language-plaintext highlighter-rouge">cgi.fix_pathinfo</code> được bật, PHP sẽ cố gắng “sửa” đường dẫn file nếu nó không tìm thấy file chính xác, điều này có thể dẫn đến lỗ hổng bảo mật (ví dụ: thực thi mã PHP trong các file không phải PHP).</li>
  <li><code class="language-plaintext highlighter-rouge">max_input_vars = 100000</code>: Tăng số lượng biến đầu vào tối đa mà PHP có thể xử lý, hữu ích cho các form lớn hoặc các ứng dụng phức tạp.</li>
  <li><code class="language-plaintext highlighter-rouge">mv -f /etc/php.d/20-curl.ini.disabled /etc/php.d/20-curl.ini</code>: Kích hoạt extension <code class="language-plaintext highlighter-rouge">curl</code> cho PHP.</li>
</ul>

<p><strong>Tại sao cần:</strong> Tối ưu hóa PHP giúp cải thiện hiệu suất ứng dụng web và khắc phục các vấn đề liên quan đến giới hạn tài nguyên hoặc bảo mật.</p>

<h3 id="8-giới-hạn-hệ-thống-system-limits">8. Giới hạn Hệ thống (System Limits)</h3>

<p>Script cấu hình giới hạn tài nguyên cho người dùng và tiến trình thông qua <code class="language-plaintext highlighter-rouge">limits.d</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'root soft nproc unlimited\n* soft nproc 65535\n* hard nproc 65535\n* soft nofile 1000000\n* hard nofile 1000000'</span> <span class="o">&gt;</span> /etc/security/limits.d/20-nproc.conf  <span class="o">&amp;&amp;</span> sysctl <span class="nt">--system</span>
</code></pre></div></div>

<p><strong>Giải thích:</strong></p>
<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">/etc/security/limits.d/20-nproc.conf</code></strong>: File cấu hình giới hạn tài nguyên cho người dùng.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">root soft nproc unlimited</code>: Người dùng <code class="language-plaintext highlighter-rouge">root</code> có thể tạo số lượng tiến trình không giới hạn (soft limit).</li>
      <li><code class="language-plaintext highlighter-rouge">* soft nproc 65535</code>: Tất cả người dùng khác có thể tạo tối đa 65535 tiến trình (soft limit).</li>
      <li><code class="language-plaintext highlighter-rouge">* hard nproc 65535</code>: Giới hạn cứng cho số lượng tiến trình.</li>
      <li><code class="language-plaintext highlighter-rouge">* soft nofile 1000000</code>: Giới hạn mềm cho số lượng file mở.</li>
      <li><code class="language-plaintext highlighter-rouge">* hard nofile 1000000</code>: Giới hạn cứng cho số lượng file mở.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">sysctl --system</code>: Áp dụng các thay đổi <code class="language-plaintext highlighter-rouge">sysctl</code> ngay lập tức.</li>
</ul>

<p><strong>Tại sao cần:</strong> Các ứng dụng web và cơ sở dữ liệu thường cần mở rất nhiều file và tạo nhiều tiến trình. Tăng các giới hạn này giúp ngăn chặn lỗi “Too many open files” hoặc “Cannot fork” dưới tải cao.</p>

<h3 id="9-tối-ưu-hóa-kernel-với-sysctlsh">9. Tối ưu hóa Kernel với <code class="language-plaintext highlighter-rouge">sysctl.sh</code></h3>

<p>Script <code class="language-plaintext highlighter-rouge">sysctl.sh</code> được gọi để áp dụng các tinh chỉnh kernel quan trọng, cải thiện hiệu suất mạng và hệ thống.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-sL</span> https://raw.githubusercontent.com/YogSottot/useful_scripts/master/initial_server_setup/sysctl.sh | bash
</code></pre></div></div>

<p><strong>Giải thích chi tiết về <code class="language-plaintext highlighter-rouge">sysctl.sh</code>:</strong>
Script này điều chỉnh các thông số kernel thông qua <code class="language-plaintext highlighter-rouge">sysctl</code> để tối ưu hóa hiệu suất mạng (TCP/IP stack), quản lý bộ nhớ và các giới hạn khác.</p>

<p><strong>Các thông số quan trọng:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">fs.nr_open</code>, <code class="language-plaintext highlighter-rouge">fs.file-max</code>: Tăng giới hạn số lượng file mà hệ thống có thể mở.</li>
  <li><code class="language-plaintext highlighter-rouge">kernel.msgmni</code>, <code class="language-plaintext highlighter-rouge">kernel.sem</code>, <code class="language-plaintext highlighter-rouge">kernel.shmmax</code>, <code class="language-plaintext highlighter-rouge">kernel.shmall</code>: Các thông số liên quan đến System V IPC (Inter-Process Communication), quan trọng cho một số ứng dụng.</li>
  <li><code class="language-plaintext highlighter-rouge">net.core.wmem_max</code>, <code class="language-plaintext highlighter-rouge">net.core.rmem_max</code>: Tăng kích thước buffer gửi/nhận tối đa cho socket.</li>
  <li><code class="language-plaintext highlighter-rouge">net.ipv4.tcp_rmem</code>, <code class="language-plaintext highlighter-rouge">net.ipv4.tcp_wmem</code>: Cấu hình kích thước buffer TCP.</li>
  <li><code class="language-plaintext highlighter-rouge">net.core.netdev_max_backlog</code>, <code class="language-plaintext highlighter-rouge">net.core.somaxconn</code>: Tăng hàng đợi cho các kết nối mạng đến.</li>
  <li><code class="language-plaintext highlighter-rouge">net.ipv4.tcp_fin_timeout</code>, <code class="language-plaintext highlighter-rouge">net.ipv4.tcp_keepalive_*</code>: Tinh chỉnh các thông số TCP keepalive và timeout để quản lý kết nối hiệu quả hơn.</li>
  <li><code class="language-plaintext highlighter-rouge">net.ipv4.tcp_max_syn_backlog</code>: Tăng hàng đợi cho các yêu cầu kết nối TCP SYN.</li>
  <li><code class="language-plaintext highlighter-rouge">vm.swappiness</code>: Giảm giá trị này (ví dụ: 10) để kernel ít sử dụng swap hơn, ưu tiên giữ dữ liệu trong RAM.</li>
  <li><code class="language-plaintext highlighter-rouge">net.ipv4.ip_local_port_range</code>: Mở rộng dải cổng cục bộ có sẵn.</li>
  <li><code class="language-plaintext highlighter-rouge">net.netfilter.nf_conntrack_max</code>: Tăng số lượng kết nối được theo dõi bởi Netfilter (conntrack), quan trọng cho các máy chủ có nhiều kết nối đồng thời.</li>
</ul>

<p><strong>Tại sao cần:</strong> Tối ưu hóa kernel là một bước quan trọng để máy chủ có thể xử lý lượng lớn kết nối mạng, quản lý tài nguyên hiệu quả và duy trì hiệu suất cao dưới tải nặng.</p>

<h3 id="10-cấu-hình-mydumpermyloader-với-mydumper_cnf_setupsh">10. Cấu hình Mydumper/Myloader với <code class="language-plaintext highlighter-rouge">mydumper_cnf_setup.sh</code></h3>

<p>Script này tự động thêm cấu hình cho <code class="language-plaintext highlighter-rouge">mydumper</code> và <code class="language-plaintext highlighter-rouge">myloader</code> vào file <code class="language-plaintext highlighter-rouge">.my.cnf</code> của người dùng <code class="language-plaintext highlighter-rouge">root</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-sL</span> https://raw.githubusercontent.com/YogSottot/useful_scripts/master/initial_server_setup/mydumper_cnf_setup.sh | bash
</code></pre></div></div>

<p><strong>Giải thích chi tiết về <code class="language-plaintext highlighter-rouge">mydumper_cnf_setup.sh</code>:</strong>
Script này đọc thông tin <code class="language-plaintext highlighter-rouge">user</code>, <code class="language-plaintext highlighter-rouge">password</code>, <code class="language-plaintext highlighter-rouge">socket</code> từ phần <code class="language-plaintext highlighter-rouge">[client]</code> trong <code class="language-plaintext highlighter-rouge">/root/.my.cnf</code> và sau đó thêm các phần <code class="language-plaintext highlighter-rouge">[mydumper]</code> và <code class="language-plaintext highlighter-rouge">[myloader]</code> vào file đó với cùng thông tin xác thực.</p>

<p><strong>Đoạn mã quan trọng:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Trong mydumper_cnf_setup.sh</span>
<span class="nv">sectionContent</span><span class="o">=</span><span class="si">$(</span><span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'/^\['</span>client<span class="se">\]</span>/,/^<span class="se">\[</span><span class="s1">'/p'</span> <span class="nv">$pathToIniFile</span> | <span class="nb">sed</span> <span class="nt">-e</span> <span class="s1">'/^\['</span>/d<span class="s1">' | sed -e '</span>/^<span class="nv">$/</span>d<span class="s1">');
username=$(getValueFromINI "$sectionContent" "user");
password=$(getValueFromINI "$sectionContent" "password");
socket=$(getValueFromINI "$sectionContent" "socket");

echo -e "\n[mydumper]\nuser=${username}\npassword=${password}\nsocket=${socket}\n\n[myloader]\nuser=${username}\npassword=${password}\nsocket=${socket}\n" &gt;&gt; $pathToIniFile
</span></code></pre></div></div>

<p><strong>Tại sao cần:</strong> <code class="language-plaintext highlighter-rouge">mydumper</code> và <code class="language-plaintext highlighter-rouge">myloader</code> là các công cụ sao lưu/phục hồi MySQL song song, nhanh hơn <code class="language-plaintext highlighter-rouge">mysqldump</code> truyền thống. Việc cấu hình sẵn thông tin xác thực giúp việc sử dụng chúng trở nên thuận tiện và an toàn hơn.</p>

<h3 id="11-tối-ưu-hóa-mysql-với-mysql_setupsh">11. Tối ưu hóa MySQL với <code class="language-plaintext highlighter-rouge">mysql_setup.sh</code></h3>

<p>Script này áp dụng một loạt các tinh chỉnh cho MySQL để cải thiện hiệu suất và độ ổn định.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-sL</span> https://raw.githubusercontent.com/YogSottot/useful_scripts/master/initial_server_setup/mysql_setup.sh | bash
</code></pre></div></div>

<p><strong>Giải thích chi tiết về <code class="language-plaintext highlighter-rouge">mysql_setup.sh</code>:</strong>
Script này tạo file <code class="language-plaintext highlighter-rouge">/etc/mysql/conf.d/z_bx_custom.cnf</code> và điền vào đó các cấu hình MySQL được khuyến nghị.</p>

<p><strong>Các thông số quan trọng:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">max_connections</code>: Số lượng kết nối tối đa mà MySQL server chấp nhận.</li>
  <li><code class="language-plaintext highlighter-rouge">long_query_time</code>, <code class="language-plaintext highlighter-rouge">log-queries-not-using-indexes</code>: Cấu hình log slow query, giúp bạn xác định các truy vấn cần tối ưu hóa.</li>
  <li><code class="language-plaintext highlighter-rouge">innodb_buffer_pool_size</code>: Kích thước bộ nhớ đệm cho InnoDB, đây là thông số quan trọng nhất ảnh hưởng đến hiệu suất MySQL. Giá trị này nên được đặt dựa trên tổng RAM của máy chủ.</li>
  <li><code class="language-plaintext highlighter-rouge">innodb_buffer_pool_instances</code>: Chia buffer pool thành nhiều instance để giảm contention.</li>
  <li><code class="language-plaintext highlighter-rouge">table_open_cache</code>: Số lượng bảng tối đa mà MySQL có thể giữ trong bộ nhớ đệm.</li>
  <li><code class="language-plaintext highlighter-rouge">innodb_flush_log_at_trx_commit</code>: Kiểm soát độ bền của giao dịch. Giá trị <code class="language-plaintext highlighter-rouge">0</code> hoặc <code class="language-plaintext highlighter-rouge">2</code> có thể cải thiện hiệu suất nhưng giảm độ bền trong trường hợp mất điện.</li>
  <li><code class="language-plaintext highlighter-rouge">skip-name-resolve</code>: Tắt phân giải DNS cho các kết nối client, tăng tốc độ kết nối.</li>
  <li><code class="language-plaintext highlighter-rouge">skip-networking</code>: Chỉ cho phép kết nối cục bộ (qua socket), tăng cường bảo mật nếu MySQL không cần truy cập từ xa.</li>
  <li><code class="language-plaintext highlighter-rouge">default_password_lifetime=0</code>: Vô hiệu hóa chính sách hết hạn mật khẩu mặc định.</li>
</ul>

<p><strong>Tại sao cần:</strong> MySQL là trái tim của nhiều ứng dụng web. Việc tối ưu hóa cấu hình MySQL là cực kỳ quan trọng để đảm bảo ứng dụng của bạn hoạt động nhanh chóng và ổn định, đặc biệt dưới tải cao.</p>

<h3 id="12-đồng-bộ-thời-gian-với-chrony">12. Đồng bộ thời gian với Chrony</h3>

<p>Script chuyển từ <code class="language-plaintext highlighter-rouge">ntpd</code> sang <code class="language-plaintext highlighter-rouge">chronyd</code> để đồng bộ thời gian.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl stop ntpd
systemctl disable ntpd
systemctl <span class="nb">enable </span>chronyd
systemctl restart chronyd
</code></pre></div></div>

<p><strong>Giải thích:</strong> <code class="language-plaintext highlighter-rouge">chronyd</code> thường được ưu tiên hơn <code class="language-plaintext highlighter-rouge">ntpd</code> trên các hệ thống Linux hiện đại vì nó có khả năng đồng bộ thời gian nhanh hơn, chính xác hơn và hoạt động tốt hơn trong các môi trường ảo hóa hoặc khi máy chủ thường xuyên bị tạm dừng.</p>

<p><strong>Tại sao cần:</strong> Đồng bộ thời gian chính xác là rất quan trọng cho các hoạt động log, chứng chỉ SSL, xác thực và nhiều tác vụ hệ thống khác.</p>

<h3 id="13-vô-hiệu-hóa-các-dịch-vụ-không-cần-thiết">13. Vô hiệu hóa các Dịch vụ không cần thiết</h3>

<p>Script dừng và vô hiệu hóa một số dịch vụ có thể không cần thiết trong môi trường cụ thể này.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl stop stunnel.service
systemctl disable stunnel
systemctl stop httpd-scale.service
systemctl disable httpd-scale.service
find /etc/cron.d/bx_httpd-scale <span class="nt">-type</span> f <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/* * * * */#* * * * */g'</span>
</code></pre></div></div>

<p><strong>Giải thích:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">stunnel</code>: Một proxy SSL/TLS. Có thể không cần thiết nếu bạn đã sử dụng Nginx để xử lý SSL.</li>
  <li><code class="language-plaintext highlighter-rouge">httpd-scale</code>: Một dịch vụ liên quan đến việc mở rộng Apache HTTPD. Có thể không cần thiết nếu bạn đang sử dụng Nginx làm reverse proxy hoặc không sử dụng Apache.</li>
  <li><code class="language-plaintext highlighter-rouge">sed -i 's/* * * * */#* * * * */g'</code>: Comment out các dòng trong cron job liên quan đến <code class="language-plaintext highlighter-rouge">bx_httpd-scale</code> để vô hiệu hóa chúng.</li>
</ul>

<p><strong>Tại sao cần:</strong> Vô hiệu hóa các dịch vụ không cần thiết giúp giảm thiểu bề mặt tấn công, giải phóng tài nguyên hệ thống và đơn giản hóa việc quản lý.</p>

<h3 id="14-cấu-hình-logrotate">14. Cấu hình Logrotate</h3>

<p>Script thiết lập <code class="language-plaintext highlighter-rouge">logrotate</code> cho các file log của Bitrix.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://raw.githubusercontent.com/YogSottot/useful_scripts/master/initial_server_setup/bitrixlog <span class="nt">-N</span> <span class="nt">-P</span> /etc/logrotate.d/
</code></pre></div></div>

<p><strong>Giải thích chi tiết về <code class="language-plaintext highlighter-rouge">bitrixlog</code>:</strong>
File này định nghĩa cách <code class="language-plaintext highlighter-rouge">logrotate</code> sẽ xử lý các file log của Bitrix.</p>

<p><strong>Đoạn mã quan trọng (từ <code class="language-plaintext highlighter-rouge">bitrixlog</code>):</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/home/bitrix/www/*.log /home/bitrix/ext_www/*/*.log {
        su bitrix bitrix
        daily
        dateext
        dateformat -%Y-%m-%d
        rotate 30
        copytruncate
        notifempty
        missingok
        compress
        sharedscripts
        }
</code></pre></div></div>

<p><strong>Giải thích:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">su bitrix bitrix</code>: Chạy <code class="language-plaintext highlighter-rouge">logrotate</code> với quyền của người dùng <code class="language-plaintext highlighter-rouge">bitrix</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">daily</code>: Xoay log hàng ngày.</li>
  <li><code class="language-plaintext highlighter-rouge">dateext</code>: Thêm ngày vào tên file log đã xoay.</li>
  <li><code class="language-plaintext highlighter-rouge">rotate 30</code>: Giữ lại 30 file log đã xoay.</li>
  <li><code class="language-plaintext highlighter-rouge">copytruncate</code>: Sao chép file log gốc và sau đó cắt ngắn nó, giúp các ứng dụng vẫn có thể ghi vào file gốc mà không cần khởi động lại.</li>
  <li><code class="language-plaintext highlighter-rouge">compress</code>: Nén các file log đã xoay.</li>
</ul>

<p><strong>Tại sao cần:</strong> Log file có thể phát triển rất lớn, chiếm dụng dung lượng đĩa. <code class="language-plaintext highlighter-rouge">logrotate</code> giúp quản lý kích thước log, tiết kiệm không gian và dễ dàng hơn trong việc phân tích log.</p>

<h3 id="15-vô-hiệu-hóa-httpd-access-logs">15. Vô hiệu hóa HTTPD Access Logs</h3>

<p>Script vô hiệu hóa ghi log truy cập cho HTTPD (Apache).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find /etc/httpd/ <span class="nt">-type</span> f <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/CustomLog/#CustomLog/g'</span>
find /etc/httpd/ <span class="nt">-type</span> f <span class="nt">-print0</span> | xargs <span class="nt">-0</span> <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/LogFormat "%h/LogFormat "%a/g'</span>
systemctl reload httpd
</code></pre></div></div>

<p><strong>Giải thích:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">sed -i 's/CustomLog/#CustomLog/g'</code>: Comment out các dòng <code class="language-plaintext highlighter-rouge">CustomLog</code> trong cấu hình Apache, ngăn Apache ghi log truy cập.</li>
  <li><code class="language-plaintext highlighter-rouge">sed -i 's/LogFormat "%h/LogFormat "%a/g'</code>: Thay đổi định dạng log để sử dụng địa chỉ IP thực (<code class="language-plaintext highlighter-rouge">%a</code>) thay vì hostname (<code class="language-plaintext highlighter-rouge">%h</code>), hữu ích khi có reverse proxy như Nginx.</li>
</ul>

<p><strong>Tại sao cần:</strong> Nếu Nginx đang hoạt động như một reverse proxy và ghi log truy cập, việc vô hiệu hóa log của Apache có thể tránh trùng lặp và tiết kiệm tài nguyên.</p>

<h3 id="16-cập-nhật-bảo-mật-tự-động-với-yum_cron_securesh">16. Cập nhật Bảo mật Tự động với <code class="language-plaintext highlighter-rouge">yum_cron_secure.sh</code></h3>

<p>Script này cài đặt và cấu hình <code class="language-plaintext highlighter-rouge">yum-cron</code> để tự động cài đặt các bản cập nhật bảo mật.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash &lt;<span class="o">(</span>curl <span class="nt">-sL</span> https://raw.githubusercontent.com/YogSottot/useful_scripts/master/initial_server_setup/yum_cron_secure.sh<span class="o">)</span>
</code></pre></div></div>

<p><strong>Giải thích chi tiết về <code class="language-plaintext highlighter-rouge">yum_cron_secure.sh</code>:</strong>
Script này cài đặt gói <code class="language-plaintext highlighter-rouge">yum-cron</code> và sau đó ghi đè file cấu hình <code class="language-plaintext highlighter-rouge">/etc/yum/yum-cron.conf</code> với các cài đặt được tối ưu hóa.</p>

<p><strong>Đoạn mã quan trọng (từ <code class="language-plaintext highlighter-rouge">yum_cron_secure.sh</code>):</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Trong /etc/yum/yum-cron.conf</span>
update_cmd <span class="o">=</span> security
download_updates <span class="o">=</span> <span class="nb">yes
</span>apply_updates <span class="o">=</span> <span class="nb">yes
</span>random_sleep <span class="o">=</span> 360
emit_via <span class="o">=</span> stdio
</code></pre></div></div>

<p><strong>Giải thích:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">update_cmd = security</code>: Chỉ áp dụng các bản cập nhật bảo mật.</li>
  <li><code class="language-plaintext highlighter-rouge">download_updates = yes</code>: Tự động tải xuống các bản cập nhật.</li>
  <li><code class="language-plaintext highlighter-rouge">apply_updates = yes</code>: Tự động cài đặt các bản cập nhật.</li>
  <li><code class="language-plaintext highlighter-rouge">random_sleep = 360</code>: Chờ một khoảng thời gian ngẫu nhiên (tối đa 360 phút) trước khi chạy, giúp phân tán tải trên các máy chủ cập nhật.</li>
  <li><code class="language-plaintext highlighter-rouge">emit_via = stdio</code>: Gửi thông báo qua stdout, cho phép cron gửi email thông báo nếu được cấu hình.</li>
</ul>

<p><strong>Tại sao cần:</strong> Bảo mật là ưu tiên hàng đầu. Tự động cập nhật các bản vá bảo mật giúp bảo vệ máy chủ của bạn khỏi các lỗ hổng đã biết mà không cần can thiệp thủ công thường xuyên.</p>

<h3 id="17-các-cài-đặt-tùy-chọn">17. Các Cài đặt Tùy chọn</h3>

<p>Cuối cùng, script sẽ hỏi bạn có muốn cài đặt và cấu hình các dịch vụ bổ sung hay không:</p>

<ul>
  <li><strong>Postfix (cho email)</strong>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"Do you wish to install postfix?"</span>
<span class="k">select </span>yn <span class="k">in</span> <span class="s2">"Yes"</span> <span class="s2">"No"</span><span class="p">;</span> <span class="k">do
    case</span> <span class="nv">$yn</span> <span class="k">in
        </span>Yes <span class="p">)</span> bash &lt;<span class="o">(</span>curl <span class="nt">-sL</span> https://raw.githubusercontent.com/YogSottot/useful_scripts/master/initial_server_setup/postfix.sh<span class="o">)</span> <span class="p">;</span> <span class="nb">break</span><span class="p">;;</span> 
        No <span class="p">)</span> <span class="nb">exit</span><span class="p">;;</span> 
    <span class="k">esac</span>
<span class="k">done</span>
</code></pre></div>    </div>
    <p><strong>Giải thích:</strong> Nếu bạn chọn “Yes”, script <code class="language-plaintext highlighter-rouge">postfix.sh</code> sẽ được chạy. Script này cấu hình Postfix làm Mail Transfer Agent (MTA) để gửi email từ máy chủ. Nó cũng cung cấp tùy chọn thiết lập relay SMTP với xác thực, rất quan trọng cho các ứng dụng cần gửi email thông báo hoặc giao dịch.
<strong>Cấu hình:</strong> Script <code class="language-plaintext highlighter-rouge">postfix.sh</code> sẽ hỏi bạn các thông tin như relay SMTP server, cổng, login, password và domain.</p>
  </li>
  <li><strong>Zabbix (giám sát)</strong>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"Do you wish to install zabbix?"</span>
<span class="k">select </span>yn <span class="k">in</span> <span class="s2">"Yes"</span> <span class="s2">"No"</span><span class="p">;</span> <span class="k">do
    case</span> <span class="nv">$yn</span> <span class="k">in
        </span>Yes <span class="p">)</span>
                <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"Please enter a ip of zabbix server : "</span> server_ip
                <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"Please enter a zabbix server domain : "</span> domain
                <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"Please enter a hostname for this zabbix node : "</span> <span class="nb">hostname

                </span>curl <span class="nt">-sL</span> https://raw.githubusercontent.com/YogSottot/useful_scripts/master/bitrix/zabbix.sh | bash <span class="nt">-s</span> <span class="nt">--</span> <span class="k">${</span><span class="nv">server_ip</span><span class="k">}</span> <span class="k">${</span><span class="nv">domain</span><span class="k">}</span> <span class="k">${</span><span class="nv">hostname</span><span class="k">}</span>  <span class="p">;</span> <span class="nb">break</span><span class="p">;;</span>

        No <span class="p">)</span> <span class="nb">exit</span><span class="p">;;</span> 
    <span class="k">esac</span>
<span class="k">done</span>
</code></pre></div>    </div>
    <p><strong>Giải thích:</strong> Nếu bạn chọn “Yes”, script <code class="language-plaintext highlighter-rouge">bitrix/zabbix.sh</code> sẽ được chạy để cài đặt và cấu hình Zabbix Agent, cho phép máy chủ này được giám sát bởi một Zabbix Server.
<strong>Cấu hình:</strong> Bạn cần cung cấp IP của Zabbix Server, domain của Zabbix Server và hostname cho node này.</p>
  </li>
  <li><strong>Antivirus</strong>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"Do you wish to install antivirus?"</span>
<span class="k">select </span>yn <span class="k">in</span> <span class="s2">"Yes"</span> <span class="s2">"No"</span><span class="p">;</span> <span class="k">do
    case</span> <span class="nv">$yn</span> <span class="k">in
        </span>Yes <span class="p">)</span>
                <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"Please enter your email : "</span> your_mail

                curl <span class="nt">-sL</span> https://raw.githubusercontent.com/YogSottot/useful_scripts/master/av/av_setup.sh | bash <span class="nt">-s</span> <span class="nt">--</span> <span class="k">${</span><span class="nv">your_mail</span><span class="k">}</span>  <span class="p">;</span> <span class="nb">break</span><span class="p">;;</span>

        No <span class="p">)</span> <span class="nb">exit</span><span class="p">;;</span> 
    <span class="k">esac</span>
<span class="k">done</span>
</code></pre></div>    </div>
    <p><strong>Giải thích:</strong> Nếu bạn chọn “Yes”, script <code class="language-plaintext highlighter-rouge">av/av_setup.sh</code> sẽ được chạy để cài đặt và cấu hình giải pháp antivirus.
<strong>Cấu hình:</strong> Bạn cần cung cấp địa chỉ email của mình để nhận thông báo.</p>
  </li>
  <li><strong>Backup Script</strong>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"Do you wish to install backup_script?"</span>
<span class="k">select </span>yn <span class="k">in</span> <span class="s2">"Yes"</span> <span class="s2">"No"</span><span class="p">;</span> <span class="k">do
    case</span> <span class="nv">$yn</span> <span class="k">in
        </span>Yes <span class="p">)</span>
                <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"Please enter your sitename : "</span> sitename

                curl <span class="nt">-sL</span> https://raw.githubusercontent.com/YogSottot/useful_scripts/master/bitrix/auto_setup.sh | bash <span class="nt">-s</span> <span class="nt">--</span> /home/bitrix/www <span class="p">;</span> <span class="nb">break</span><span class="p">;;</span>

        No <span class="p">)</span> <span class="nb">exit</span><span class="p">;;</span> 
    <span class="k">esac</span>
<span class="k">done</span>
</code></pre></div>    </div>
    <p><strong>Giải thích:</strong> Nếu bạn chọn “Yes”, script <code class="language-plaintext highlighter-rouge">bitrix/auto_setup.sh</code> sẽ được chạy để thiết lập các script sao lưu tự động.
<strong>Cấu hình:</strong> Bạn cần cung cấp tên trang web của mình.</p>
  </li>
  <li><strong>GitLab Runner</strong>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"Do you wish to install gitlab-runner?"</span>
<span class="k">select </span>yn <span class="k">in</span> <span class="s2">"Yes"</span> <span class="s2">"No"</span><span class="p">;</span> <span class="k">do
    case</span> <span class="nv">$yn</span> <span class="k">in
        </span>Yes <span class="p">)</span> curl <span class="nt">-sL</span> https://raw.githubusercontent.com/YogSottot/useful_scripts/master/git/runner.sh | bash <span class="p">;</span> <span class="nb">break</span><span class="p">;;</span> 
        No <span class="p">)</span> <span class="nb">exit</span><span class="p">;;</span> 
    <span class="k">esac</span>
<span class="k">done</span>
</code></pre></div>    </div>
    <p><strong>Giải thích:</strong> Nếu bạn chọn “Yes”, script <code class="language-plaintext highlighter-rouge">git/runner.sh</code> sẽ được chạy để cài đặt GitLab Runner, cho phép máy chủ này thực hiện các tác vụ CI/CD từ GitLab.</p>
  </li>
</ul>

<p><strong>Tại sao cần:</strong> Các tùy chọn này cho phép bạn mở rộng chức năng của máy chủ theo nhu cầu cụ thể của dự án, từ gửi email, giám sát, bảo mật đến tự động hóa CI/CD.</p>

<h2 id="kết-luận">Kết luận</h2>

<p>Bộ script <code class="language-plaintext highlighter-rouge">initial_server_setup</code> cung cấp một giải pháp toàn diện để tự động hóa quá trình cấu hình máy chủ Linux ban đầu. Bằng cách tận dụng các script này, bạn có thể:</p>

<ul>
  <li><strong>Tiết kiệm thời gian</strong>: Giảm đáng kể thời gian thiết lập thủ công.</li>
  <li><strong>Đảm bảo tính nhất quán</strong>: Áp dụng cùng một cấu hình trên nhiều máy chủ.</li>
  <li><strong>Tăng cường bảo mật</strong>: Tự động hóa các biện pháp bảo mật cơ bản.</li>
  <li><strong>Cải thiện hiệu suất</strong>: Áp dụng các tinh chỉnh tối ưu cho hệ thống, Nginx, PHP và MySQL.</li>
</ul>

<p>Hãy nhớ rằng, việc hiểu rõ từng bước và tùy chỉnh script theo môi trường của bạn là chìa khóa để tận dụng tối đa bộ công cụ mạnh mẽ này. Chúc bạn thành công!</p>]]></content><author><name></name></author><category term="initial-setup" /><summary type="html"><![CDATA[Chào các bạn DevOps và Full-stack Developer!]]></summary></entry><entry><title type="html">Thiết lập máy chủ ban đầu hiệu quả với các Script tự động</title><link href="https://yourusername.github.io/useful_scripts/initial-setup/2025/10/15/initial-server-setup-guide.html" rel="alternate" type="text/html" title="Thiết lập máy chủ ban đầu hiệu quả với các Script tự động" /><published>2025-10-15T11:00:00+00:00</published><updated>2025-10-15T11:00:00+00:00</updated><id>https://yourusername.github.io/useful_scripts/initial-setup/2025/10/15/initial-server-setup-guide</id><content type="html" xml:base="https://yourusername.github.io/useful_scripts/initial-setup/2025/10/15/initial-server-setup-guide.html"><![CDATA[<p>Chào các bạn DevOps và Full-stack Developer!</p>

<p>Việc thiết lập một máy chủ mới thường tốn rất nhiều thời gian và công sức, đặc biệt là khi bạn cần đảm bảo hiệu suất, bảo mật và các cấu hình tối ưu. Trong bài viết này, chúng ta sẽ khám phá bộ sưu tập các script tự động trong thư mục <code class="language-plaintext highlighter-rouge">initial_server_setup/</code> giúp bạn đơn giản hóa quá trình này.</p>

<h2 id="initial_setupsh-trái-tim-của-quá-trình-thiết-lập"><code class="language-plaintext highlighter-rouge">initial_setup.sh</code>: Trái tim của quá trình thiết lập</h2>

<p>Script <code class="language-plaintext highlighter-rouge">initial_setup.sh</code> là điểm khởi đầu chính, tự động hóa nhiều tác vụ quan trọng. Khi chạy script này, bạn sẽ được hướng dẫn qua các bước sau:</p>

<ol>
  <li><strong>Cài đặt các công cụ hữu ích</strong>: Tự động cài đặt các gói phần mềm cần thiết như <code class="language-plaintext highlighter-rouge">wget</code>, <code class="language-plaintext highlighter-rouge">byobu</code>, <code class="language-plaintext highlighter-rouge">chrony</code>, <code class="language-plaintext highlighter-rouge">certbot</code>, <code class="language-plaintext highlighter-rouge">htop</code>, <code class="language-plaintext highlighter-rouge">ncdu</code>, <code class="language-plaintext highlighter-rouge">iotop</code>, <code class="language-plaintext highlighter-rouge">mc</code>, <code class="language-plaintext highlighter-rouge">tmux</code>, <code class="language-plaintext highlighter-rouge">jpegoptim</code>, <code class="language-plaintext highlighter-rouge">optipng</code>, <code class="language-plaintext highlighter-rouge">libwebp-tools</code>, <code class="language-plaintext highlighter-rouge">ImageMagick</code>, <code class="language-plaintext highlighter-rouge">php-pecl-imagick</code>, <code class="language-plaintext highlighter-rouge">mysqltuner</code>, <code class="language-plaintext highlighter-rouge">smem</code>, <code class="language-plaintext highlighter-rouge">lsof</code> và nhiều công cụ khác giúp quản lý và tối ưu hóa hệ thống.</li>
  <li><strong>Cấu hình môi trường làm việc</strong>: Thiết lập <code class="language-plaintext highlighter-rouge">liquidprompt</code> cho một terminal prompt thông minh, cấu hình <code class="language-plaintext highlighter-rouge">nano</code> với syntax highlighting, và tối ưu hóa hệ thống với <code class="language-plaintext highlighter-rouge">tuned-adm profile virtual-guest</code>.</li>
  <li><strong>Bảo mật SSH</strong>: Tự động tạo cặp khóa SSH (<code class="language-plaintext highlighter-rouge">ed25519</code>) cho người dùng <code class="language-plaintext highlighter-rouge">root</code> và <code class="language-plaintext highlighter-rouge">bitrix</code>, tăng cường bảo mật cho việc truy cập máy chủ.</li>
  <li><strong>Let’s Encrypt và SSL</strong>: Cấu hình <code class="language-plaintext highlighter-rouge">certbot</code> để tự động gia hạn chứng chỉ SSL từ Let’s Encrypt, đảm bảo các dịch vụ web của bạn luôn được bảo mật với HTTPS.</li>
  <li><strong>Tối ưu hóa dịch vụ hệ thống</strong>: Thiết lập <code class="language-plaintext highlighter-rouge">systemd</code> để tự động khởi động lại các dịch vụ quan trọng như Nginx, HTTPD, Memcached khi gặp lỗi, đồng thời tăng giới hạn tài nguyên (<code class="language-plaintext highlighter-rouge">LimitNPROC</code>, <code class="language-plaintext highlighter-rouge">LimitNOFILE</code>).</li>
  <li><strong>Cấu hình Nginx và PHP</strong>: Áp dụng các cấu hình Nginx cơ bản (gzip, server tokens) và các tinh chỉnh PHP (<code class="language-plaintext highlighter-rouge">max_input_vars</code>, <code class="language-plaintext highlighter-rouge">pcre.recursion_limit</code>) để cải thiện hiệu suất và bảo mật.</li>
  <li><strong>Giới hạn hệ thống (ulimit)</strong>: Tăng giới hạn số lượng tiến trình và tệp mở cho người dùng, giúp máy chủ xử lý tải cao tốt hơn.</li>
  <li><strong>Đồng bộ thời gian</strong>: Chuyển từ <code class="language-plaintext highlighter-rouge">ntpd</code> sang <code class="language-plaintext highlighter-rouge">chronyd</code> để đồng bộ thời gian chính xác hơn.</li>
  <li><strong>Cấu hình MySQL</strong>: Gọi script <code class="language-plaintext highlighter-rouge">mysql_setup.sh</code> để áp dụng các cấu hình MySQL tối ưu cho hiệu suất và độ ổn định.</li>
  <li><strong>Cấu hình Logrotate</strong>: Thiết lập <code class="language-plaintext highlighter-rouge">logrotate</code> cho các tệp log của Bitrix, giúp quản lý dung lượng đĩa hiệu quả.</li>
  <li><strong>Cập nhật bảo mật tự động</strong>: Gọi script <code class="language-plaintext highlighter-rouge">yum_cron_secure.sh</code> để cài đặt và cấu hình <code class="language-plaintext highlighter-rouge">yum-cron</code>, đảm bảo máy chủ luôn được cập nhật các bản vá bảo mật quan trọng.</li>
  <li><strong>Cài đặt tùy chọn</strong>: Script sẽ hỏi bạn có muốn cài đặt và cấu hình Postfix (cho email), Zabbix (giám sát), Antivirus (bảo mật) và GitLab Runner (CI/CD) hay không, cho phép bạn tùy chỉnh quá trình thiết lập.</li>
</ol>

<h2 id="các-script-hỗ-trợ-quan-trọng">Các Script hỗ trợ quan trọng</h2>

<p>Ngoài <code class="language-plaintext highlighter-rouge">initial_setup.sh</code>, các script sau đóng vai trò quan trọng trong việc hoàn thiện cấu hình máy chủ:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">cron_deduplicator_template.sh</code></strong>: Một template hữu ích để đảm bảo chỉ có một instance của cron job chạy tại một thời điểm, tránh các vấn đề về tài nguyên và dữ liệu.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">mydumper_cnf_setup.sh</code></strong>: Tự động thêm cấu hình cho <code class="language-plaintext highlighter-rouge">mydumper</code> và <code class="language-plaintext highlighter-rouge">myloader</code> vào tệp <code class="language-plaintext highlighter-rouge">.my.cnf</code>, giúp việc sao lưu và phục hồi MySQL dễ dàng hơn.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">mysql_setup.sh</code></strong>: Chứa các tinh chỉnh chi tiết cho MySQL, bao gồm <code class="language-plaintext highlighter-rouge">max_connections</code>, <code class="language-plaintext highlighter-rouge">long_query_time</code>, <code class="language-plaintext highlighter-rouge">innodb_buffer_pool_size</code>, <code class="language-plaintext highlighter-rouge">table_open_cache</code>, và nhiều thông số khác để tối ưu hóa cơ sở dữ liệu.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">opcache.php</code></strong>: Một công cụ PHP đơn giản nhưng mạnh mẽ để theo dõi trạng thái và cấu hình của OPcache, giúp bạn đảm bảo PHP đang hoạt động hiệu quả.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">postfix.sh</code></strong>: Cấu hình Postfix để gửi email từ máy chủ, bao gồm cả tùy chọn thiết lập relay với xác thực, rất quan trọng cho các ứng dụng cần gửi thông báo qua email.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">sysctl.sh</code></strong>: Tối ưu hóa các tham số kernel (<code class="language-plaintext highlighter-rouge">sysctl</code>) như <code class="language-plaintext highlighter-rouge">fs.nr_open</code>, <code class="language-plaintext highlighter-rouge">net.core</code>, <code class="language-plaintext highlighter-rouge">net.ipv4</code> để cải thiện hiệu suất mạng và khả năng xử lý tệp của hệ thống.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">yum_cron_secure.sh</code></strong>: Đảm bảo máy chủ của bạn luôn được bảo vệ bằng cách tự động cài đặt các bản cập nhật bảo mật thông qua <code class="language-plaintext highlighter-rouge">yum-cron</code>.</li>
</ul>

<h2 id="khi-nào-nên-sử-dụng">Khi nào nên sử dụng?</h2>

<p>Bộ script này lý tưởng cho:</p>

<ul>
  <li><strong>Thiết lập máy chủ mới</strong>: Giúp bạn nhanh chóng có một máy chủ được cấu hình tốt từ đầu.</li>
  <li><strong>Tối ưu hóa máy chủ hiện có</strong>: Áp dụng các tinh chỉnh hiệu suất và bảo mật một cách có hệ thống.</li>
  <li><strong>Đảm bảo tính nhất quán</strong>: Sử dụng các script này trên nhiều máy chủ để đảm bảo cấu hình đồng nhất.</li>
</ul>

<h2 id="lời-khuyên-cho-devopsfull-stack-developer">Lời khuyên cho DevOps/Full-stack Developer</h2>

<ul>
  <li><strong>Đọc và hiểu script</strong>: Mặc dù các script này tự động hóa, nhưng việc đọc và hiểu chúng là rất quan trọng để bạn biết chính xác những gì đang diễn ra trên máy chủ của mình.</li>
  <li><strong>Tùy chỉnh</strong>: Các script này cung cấp một nền tảng tốt. Đừng ngần ngại tùy chỉnh chúng để phù hợp với nhu cầu cụ thể của dự án và môi trường của bạn.</li>
  <li><strong>Kiểm tra</strong>: Luôn kiểm tra các thay đổi trong môi trường staging trước khi triển khai lên production.</li>
</ul>

<p>Hy vọng bài viết này giúp bạn có cái nhìn tổng quan và biết cách tận dụng bộ script <code class="language-plaintext highlighter-rouge">initial_server_setup/</code> để quản lý máy chủ hiệu quả hơn!</p>]]></content><author><name></name></author><category term="initial-setup" /><summary type="html"><![CDATA[Chào các bạn DevOps và Full-stack Developer!]]></summary></entry><entry><title type="html">How to use av/botblock.sh</title><link href="https://yourusername.github.io/useful_scripts/av/2025/10/15/how-to-use-av-botblock.html" rel="alternate" type="text/html" title="How to use av/botblock.sh" /><published>2025-10-15T10:00:00+00:00</published><updated>2025-10-15T10:00:00+00:00</updated><id>https://yourusername.github.io/useful_scripts/av/2025/10/15/how-to-use-av-botblock</id><content type="html" xml:base="https://yourusername.github.io/useful_scripts/av/2025/10/15/how-to-use-av-botblock.html"><![CDATA[<p>This script (<code class="language-plaintext highlighter-rouge">av/botblock.sh</code>) is designed to block malicious bots from accessing your server. It leverages various techniques to identify and block unwanted traffic.</p>

<h2 id="when-to-use-it">When to use it</h2>

<p>Use this script when you are experiencing:</p>

<ul>
  <li>High server load due to bot traffic.</li>
  <li>Suspicious access attempts from unknown IPs.</li>
  <li>Scraping activities on your website.</li>
</ul>

<h2 id="how-to-use-it">How to use it</h2>

<ol>
  <li><strong>Review the script:</strong> Before running, it’s highly recommended to review the script’s content to understand its actions and ensure it aligns with your server’s configuration.</li>
  <li>
    <p><strong>Execute the script:</strong> You can run the script directly from your server’s terminal:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/path/to/useful_scripts/av/botblock.sh
</code></pre></div>    </div>
  </li>
  <li><strong>Monitor logs:</strong> After execution, monitor your server logs (e.g., Nginx, Apache, system logs) to verify that bots are being blocked as expected.</li>
</ol>

<h2 id="customization">Customization</h2>

<p>The script might contain configurable variables at the beginning. You can modify these variables to tailor its behavior to your specific needs, such as:</p>

<ul>
  <li><strong>IP Blacklists:</strong> Add or remove IP addresses from the blacklist.</li>
  <li><strong>User-Agent patterns:</strong> Define patterns to identify and block specific user agents.</li>
</ul>

<p>Remember to always back up your server configuration before making significant changes.</p>]]></content><author><name></name></author><category term="av" /><summary type="html"><![CDATA[This script (av/botblock.sh) is designed to block malicious bots from accessing your server. It leverages various techniques to identify and block unwanted traffic.]]></summary></entry></feed>